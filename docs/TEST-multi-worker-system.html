<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Worker System Test Program</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #0d1117;
            color: #c9d1d9;
        }

        h1 {
            color: #58a6ff;
            border-bottom: 2px solid #30363d;
            padding-bottom: 10px;
        }

        h2 {
            color: #7ee787;
            margin-top: 40px;
            padding: 10px 15px;
            background: #161b22;
            border-left: 4px solid #7ee787;
            border-radius: 0 6px 6px 0;
        }

        h3 {
            color: #ffa657;
            margin-top: 25px;
        }

        .meta {
            background: #161b22;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #30363d;
        }

        .meta span {
            margin-right: 30px;
            color: #8b949e;
        }

        .meta strong {
            color: #c9d1d9;
        }

        .score-card {
            background: linear-gradient(135deg, #238636 0%, #1f6feb 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
        }

        .score-card .score {
            font-size: 64px;
            font-weight: bold;
            color: white;
        }

        .score-card .label {
            color: rgba(255,255,255,0.9);
            font-size: 18px;
        }

        .test-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .test-header {
            background: #21262d;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-header:hover {
            background: #30363d;
        }

        .test-title {
            font-weight: 600;
            color: #58a6ff;
            font-size: 16px;
        }

        .test-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: #30363d;
            color: #8b949e;
        }

        .status-running {
            background: #1f6feb;
            color: white;
        }

        .status-pass {
            background: #238636;
            color: white;
        }

        .status-fail {
            background: #da3633;
            color: white;
        }

        .test-body {
            padding: 20px;
            display: none;
        }

        .test-card.expanded .test-body {
            display: block;
        }

        .test-card.expanded .test-header {
            border-bottom: 1px solid #30363d;
        }

        .goal {
            background: #1f6feb22;
            border-left: 3px solid #1f6feb;
            padding: 10px 15px;
            margin-bottom: 20px;
            border-radius: 0 6px 6px 0;
        }

        .steps {
            counter-reset: step;
        }

        .step {
            margin: 15px 0;
            padding-left: 40px;
            position: relative;
        }

        .step::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 28px;
            height: 28px;
            background: #30363d;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: #8b949e;
        }

        .step.completed::before {
            background: #238636;
            color: white;
        }

        pre {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            color: #7ee787;
        }

        code {
            background: #30363d;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            color: #ffa657;
        }

        .checklist {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #238636;
        }

        .checklist li.checked {
            color: #8b949e;
            text-decoration: line-through;
        }

        .expected {
            background: #23863622;
            border-left: 3px solid #238636;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }

        .expected strong {
            color: #7ee787;
        }

        .cleanup {
            background: #da363322;
            border-left: 3px solid #da3633;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }

        .cleanup strong {
            color: #f85149;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: #238636;
            color: white;
        }

        .btn-primary:hover {
            background: #2ea043;
        }

        .btn-secondary {
            background: #30363d;
            color: #c9d1d9;
        }

        .btn-secondary:hover {
            background: #3c444d;
        }

        .btn-danger {
            background: #da3633;
            color: white;
        }

        .progress-bar {
            height: 8px;
            background: #30363d;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar .fill {
            height: 100%;
            background: linear-gradient(90deg, #238636, #7ee787);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .summary-table th,
        .summary-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #30363d;
        }

        .summary-table th {
            background: #21262d;
            color: #8b949e;
            font-weight: 600;
        }

        .summary-table tr:hover {
            background: #161b22;
        }

        .notes-area {
            width: 100%;
            min-height: 100px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            color: #c9d1d9;
            font-family: inherit;
            resize: vertical;
        }

        .copy-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background: #30363d;
            border: none;
            color: #8b949e;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            background: #3c444d;
            color: #c9d1d9;
        }

        .code-block {
            position: relative;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }

        .tag-api { background: #1f6feb33; color: #58a6ff; }
        .tag-mcp { background: #a371f733; color: #d2a8ff; }
        .tag-ui { background: #f7883533; color: #ffa657; }
        .tag-git { background: #23863633; color: #7ee787; }

        .accordion-icon {
            transition: transform 0.2s;
        }

        .test-card.expanded .accordion-icon {
            transform: rotate(90deg);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .score-card .score {
                font-size: 48px;
            }
        }
    </style>
</head>
<body>
    <h1>Multi-Worker System Test Program</h1>

    <div class="meta">
        <span><strong>Date:</strong> 2026-01-23</span>
        <span><strong>Version:</strong> 1.0</span>
        <span><strong>Status:</strong> Ready for Testing</span>
    </div>

    <div class="score-card">
        <div class="label">Implementation Score</div>
        <div class="score">8.5/10</div>
        <div class="label">Ready for integration testing</div>
    </div>

    <div class="progress-bar">
        <div class="fill" id="overall-progress" style="width: 0%"></div>
    </div>
    <p style="text-align: center; color: #8b949e;">
        <span id="tests-completed">0</span>/10 tests completed
    </p>

    <h2>Pre-Test Setup</h2>

    <div class="test-card expanded">
        <div class="test-header">
            <span class="test-title">Requirements Checklist</span>
        </div>
        <div class="test-body">
            <ul class="checklist" id="setup-checklist">
                <li>
                    <input type="checkbox" id="setup-1">
                    <label for="setup-1">chkd dev server running (<code>npm run dev</code> on port 3847)</label>
                </li>
                <li>
                    <input type="checkbox" id="setup-2">
                    <label for="setup-2">MCP server connected to Claude Code</label>
                </li>
                <li>
                    <input type="checkbox" id="setup-3">
                    <label for="setup-3">Clean git state (commit or stash changes)</label>
                </li>
                <li>
                    <input type="checkbox" id="setup-4">
                    <label for="setup-4">At least 2 terminal windows available</label>
                </li>
            </ul>

            <h3>Verify Commands</h3>
            <div class="code-block">
                <pre># Check server is running
curl http://localhost:3847/api/status

# In Claude Code, verify MCP tools
chkd_status</pre>
            </div>
        </div>
    </div>

    <h2>Test Suite</h2>

    <!-- TEST 1 -->
    <div class="test-card" data-test="1">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 1: Worker Spawn (Basic)</span>
                <span class="tag tag-api">API</span>
                <span class="tag tag-mcp">MCP</span>
            </span>
            <span class="test-status status-pending" id="status-1">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Verify we can spawn a worker from the API/MCP
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Call <code>chkd_spawn_worker</code> with a test task:</strong>
                    <div class="code-block">
                        <pre>chkd_spawn_worker(
  taskId: "TEST.1",
  taskTitle: "Test Worker Spawn"
)</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify response contains:</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> <code>workerId</code> (format: <code>worker-{username}-{timestamp}-{random}</code>)</li>
                        <li><input type="checkbox"> <code>worktreePath</code> (should be <code>../chkd-{username}-1</code>)</li>
                        <li><input type="checkbox"> <code>branchName</code> (should be <code>feature/{username}/test1-test-worker-spawn</code>)</li>
                        <li><input type="checkbox"> <code>command</code> (cd + claude command)</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Verify worktree was created:</strong>
                    <div class="code-block">
                        <pre>ls -la ../chkd-*
git worktree list</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify database record:</strong>
                    <div class="code-block">
                        <pre>curl "http://localhost:3847/api/workers?repoPath=$(pwd)"</pre>
                    </div>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Worker in <code>waiting</code> status, worktree exists on filesystem
            </div>

            <div class="cleanup">
                <strong>Cleanup:</strong>
                <pre>chkd_stop_worker(workerId, force: true, deleteBranch: true)</pre>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(1, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(1, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(1, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 2 -->
    <div class="test-card" data-test="2">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 2: Worker Claim & Heartbeat</span>
                <span class="tag tag-api">API</span>
            </span>
            <span class="test-status status-pending" id="status-2">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Simulate a worker claiming a task and sending heartbeats
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Spawn a worker (as in Test 1)</strong>
                </div>

                <div class="step">
                    <strong>Simulate worker claiming (PATCH to working):</strong>
                    <div class="code-block">
                        <pre>curl -X PATCH "http://localhost:3847/api/workers/{workerId}" \
  -H "Content-Type: application/json" \
  -d '{"status": "working", "message": "Starting work..."}'</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify status changed to <code>working</code></strong>
                </div>

                <div class="step">
                    <strong>Send heartbeat updates:</strong>
                    <div class="code-block">
                        <pre># 25% progress
curl -X PATCH "http://localhost:3847/api/workers/{workerId}" \
  -H "Content-Type: application/json" \
  -d '{"message": "Implementing feature...", "progress": 25}'

# 50% progress
curl -X PATCH "http://localhost:3847/api/workers/{workerId}" \
  -H "Content-Type: application/json" \
  -d '{"message": "Adding tests...", "progress": 50}'

# 75% progress
curl -X PATCH "http://localhost:3847/api/workers/{workerId}" \
  -H "Content-Type: application/json" \
  -d '{"message": "Final touches...", "progress": 75}'</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Check UI shows progress updates</strong>
                    <p>Open <a href="http://localhost:3847" target="_blank" style="color: #58a6ff;">http://localhost:3847</a></p>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Progress bar advances, message updates in UI, <code>heartbeat_at</code> updates in database
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(2, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(2, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(2, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 3 -->
    <div class="test-card" data-test="3">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 3: Manager Signals</span>
                <span class="tag tag-api">API</span>
                <span class="tag tag-ui">UI</span>
            </span>
            <span class="test-status status-pending" id="status-3">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Verify signals are created for worker events
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Spawn a worker</strong>
                </div>

                <div class="step">
                    <strong>Check signals created:</strong>
                    <div class="code-block">
                        <pre>curl "http://localhost:3847/api/signals?repoPath=$(pwd)"</pre>
                    </div>
                    <p>Should see "Worker spawned" signal</p>
                </div>

                <div class="step">
                    <strong>Update worker to working status</strong>
                </div>

                <div class="step">
                    <strong>Check for status change signal</strong>
                </div>

                <div class="step">
                    <strong>In UI, verify signal bar shows messages</strong>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Signals appear for spawn, status changes
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(3, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(3, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(3, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 4 -->
    <div class="test-card" data-test="4">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 4: Clean Auto-Merge</span>
                <span class="tag tag-git">GIT</span>
                <span class="tag tag-api">API</span>
            </span>
            <span class="test-status status-pending" id="status-4">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Test auto-merge when no conflicts
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Spawn worker for a test task</strong>
                </div>

                <div class="step">
                    <strong>In the worktree, make a simple change:</strong>
                    <div class="code-block">
                        <pre>cd ../chkd-{username}-1
echo "// Test comment $(date)" >> test-file.txt
git add .
git commit -m "Test: Add comment"</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Update worker to working status, then call complete:</strong>
                    <div class="code-block">
                        <pre># First set to working
curl -X PATCH "http://localhost:3847/api/workers/{workerId}" \
  -H "Content-Type: application/json" \
  -d '{"status": "working"}'

# Then complete
curl -X POST "http://localhost:3847/api/workers/{workerId}/complete" \
  -H "Content-Type: application/json" \
  -d '{"message": "Test complete"}'</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify:</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> Response shows <code>mergeStatus: "clean"</code></li>
                        <li><input type="checkbox"> Worker status is <code>merged</code></li>
                        <li><input type="checkbox"> Worktree removed</li>
                        <li><input type="checkbox"> Branch merged to main</li>
                        <li><input type="checkbox"> History record created</li>
                    </ul>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Automatic merge, worktree cleanup
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(4, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(4, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(4, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 5 -->
    <div class="test-card" data-test="5">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 5: Conflict Detection</span>
                <span class="tag tag-git">GIT</span>
            </span>
            <span class="test-status status-pending" id="status-5">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Test conflict detection when files overlap
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Spawn two workers: Worker A and Worker B</strong>
                </div>

                <div class="step">
                    <strong>In Worker A's worktree, create and modify a test file:</strong>
                    <div class="code-block">
                        <pre>cd ../chkd-{username}-1
echo "Line 1 from Worker A" > conflict-test.txt
echo "Common line 2" >> conflict-test.txt
git add . && git commit -m "Worker A: Create conflict test"</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>In Worker B's worktree, create same file differently:</strong>
                    <div class="code-block">
                        <pre>cd ../chkd-{username}-2
echo "Line 1 from Worker B" > conflict-test.txt
echo "Common line 2" >> conflict-test.txt
git add . && git commit -m "Worker B: Create conflict test"</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Complete Worker A first (should merge clean)</strong>
                </div>

                <div class="step">
                    <strong>Complete Worker B (should detect conflict):</strong>
                    <div class="code-block">
                        <pre>curl -X POST "http://localhost:3847/api/workers/{workerBId}/complete"</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify:</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> Response shows <code>mergeStatus: "conflicts"</code></li>
                        <li><input type="checkbox"> <code>conflicts</code> array lists the file</li>
                        <li><input type="checkbox"> Worker status is NOT merged yet</li>
                        <li><input type="checkbox"> Signal created asking for help</li>
                    </ul>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Conflict detected, user prompted for resolution
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(5, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(5, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(5, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 6 -->
    <div class="test-card" data-test="6">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 6: Conflict Resolution</span>
                <span class="tag tag-git">GIT</span>
                <span class="tag tag-api">API</span>
            </span>
            <span class="test-status status-pending" id="status-6">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Test resolving conflicts via API
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Continue from Test 5 (Worker B has conflicts)</strong>
                </div>

                <div class="step">
                    <strong>Resolve with "keep worker's version" (ours):</strong>
                    <div class="code-block">
                        <pre>curl -X POST "http://localhost:3847/api/workers/{workerBId}/resolve" \
  -H "Content-Type: application/json" \
  -d '{"resolution": "ours"}'</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify:</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> Conflict resolved</li>
                        <li><input type="checkbox"> Worker merged</li>
                        <li><input type="checkbox"> Worktree cleaned up</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Check main branch has Worker B's version of the conflicted file</strong>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Resolution completes merge successfully
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(6, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(6, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(6, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 7 -->
    <div class="test-card" data-test="7">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 7: Dead Worker Detection</span>
                <span class="tag tag-api">API</span>
            </span>
            <span class="test-status status-pending" id="status-7">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Verify dead worker detection works
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Spawn a worker</strong>
                </div>

                <div class="step">
                    <strong>Set status to working</strong>
                </div>

                <div class="step">
                    <strong>Wait 2+ minutes without sending heartbeat</strong>
                    <p style="color: #8b949e;">(Or use a shorter threshold for testing)</p>
                </div>

                <div class="step">
                    <strong>Call dead workers endpoint:</strong>
                    <div class="code-block">
                        <pre># Use 1 minute threshold for faster testing
curl "http://localhost:3847/api/workers/dead?repoPath=$(pwd)&thresholdMinutes=1"</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify worker appears in dead list</strong>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Worker detected as dead after heartbeat timeout
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(7, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(7, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(7, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 8 -->
    <div class="test-card" data-test="8">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 8: MCP Worker Tools (Full Flow)</span>
                <span class="tag tag-mcp">MCP</span>
            </span>
            <span class="test-status status-pending" id="status-8">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Test the actual MCP tools Claude would use
            </div>

            <div class="steps">
                <div class="step">
                    <strong>As "Master Claude", spawn worker:</strong>
                    <div class="code-block">
                        <pre>chkd_spawn_worker("SD.99", "Integration Test Task")</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Note the workerId returned, check workers list:</strong>
                    <div class="code-block">
                        <pre>chkd_workers()</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Simulate worker heartbeat via MCP:</strong>
                    <div class="code-block">
                        <pre>chkd_worker_heartbeat(workerId, "Working on it...", 50)</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Pause worker:</strong>
                    <div class="code-block">
                        <pre>chkd_pause_worker(workerId)</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Resume worker:</strong>
                    <div class="code-block">
                        <pre>chkd_resume_worker(workerId)</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Stop and cleanup:</strong>
                    <div class="code-block">
                        <pre>chkd_stop_worker(workerId, force: true, deleteBranch: true)</pre>
                    </div>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> All MCP tools work correctly, status transitions happen
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(8, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(8, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(8, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 9 -->
    <div class="test-card" data-test="9">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 9: UI Components</span>
                <span class="tag tag-ui">UI</span>
            </span>
            <span class="test-status status-pending" id="status-9">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Verify UI displays correctly
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Open <a href="http://localhost:3847" target="_blank" style="color: #58a6ff;">http://localhost:3847</a></strong>
                </div>

                <div class="step">
                    <strong>Spawn a worker (via MCP or curl)</strong>
                </div>

                <div class="step">
                    <strong>Verify in the UI:</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> Worker appears in repo card</li>
                        <li><input type="checkbox"> Progress bar shows correctly</li>
                        <li><input type="checkbox"> Status badge has correct color</li>
                        <li><input type="checkbox"> Message is displayed</li>
                        <li><input type="checkbox"> Pause/Stop buttons are visible</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Test UI actions:</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> Pause button works</li>
                        <li><input type="checkbox"> Resume button works</li>
                        <li><input type="checkbox"> Stop button works</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Check Split Brain View (if available):</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> Worker panels display</li>
                        <li><input type="checkbox"> Manager signal bar shows</li>
                    </ul>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> UI accurately reflects worker state
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(9, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(9, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(9, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <!-- TEST 10 -->
    <div class="test-card" data-test="10">
        <div class="test-header" onclick="toggleTest(this)">
            <span>
                <span class="accordion-icon">&#9654;</span>
                <span class="test-title">TEST 10: Parallel Workers (Stress Test)</span>
                <span class="tag tag-api">API</span>
                <span class="tag tag-git">GIT</span>
            </span>
            <span class="test-status status-pending" id="status-10">Pending</span>
        </div>
        <div class="test-body">
            <div class="goal">
                <strong>Goal:</strong> Test two workers running simultaneously
            </div>

            <div class="steps">
                <div class="step">
                    <strong>Spawn Worker 1 for task A:</strong>
                    <div class="code-block">
                        <pre>chkd_spawn_worker("PARA.1", "Parallel Test A")</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Spawn Worker 2 for task B:</strong>
                    <div class="code-block">
                        <pre>chkd_spawn_worker("PARA.2", "Parallel Test B")</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Verify both appear in UI and <code>chkd_workers()</code></strong>
                </div>

                <div class="step">
                    <strong>Update both with progress (interleaved):</strong>
                    <div class="code-block">
                        <pre># Worker 1: 25%
chkd_worker_heartbeat(worker1Id, "W1 progress", 25)
# Worker 2: 30%
chkd_worker_heartbeat(worker2Id, "W2 progress", 30)
# Worker 1: 50%
chkd_worker_heartbeat(worker1Id, "W1 halfway", 50)
# Worker 2: 60%
chkd_worker_heartbeat(worker2Id, "W2 ahead", 60)</pre>
                    </div>
                </div>

                <div class="step">
                    <strong>Make changes in both worktrees (different files)</strong>
                </div>

                <div class="step">
                    <strong>Complete Worker 2 first, then Worker 1</strong>
                </div>

                <div class="step">
                    <strong>Verify:</strong>
                    <ul class="checklist">
                        <li><input type="checkbox"> Both merged successfully</li>
                        <li><input type="checkbox"> No race conditions</li>
                        <li><input type="checkbox"> History shows both workers</li>
                        <li><input type="checkbox"> UI updated correctly throughout</li>
                    </ul>
                </div>
            </div>

            <div class="expected">
                <strong>Expected:</strong> Parallel operation works without issues
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="markTest(10, 'pass')">Pass</button>
                <button class="btn btn-danger" onclick="markTest(10, 'fail')">Fail</button>
                <button class="btn btn-secondary" onclick="markTest(10, 'pending')">Reset</button>
            </div>

            <h4>Notes</h4>
            <textarea class="notes-area" placeholder="Add notes about this test..."></textarea>
        </div>
    </div>

    <h2>Post-Test Cleanup</h2>

    <div class="test-card expanded">
        <div class="test-header">
            <span class="test-title">Cleanup Commands</span>
        </div>
        <div class="test-body">
            <div class="code-block">
                <pre># Remove any remaining worktrees
git worktree list
git worktree remove ../chkd-* --force 2>/dev/null || true

# Remove test branches
git branch | grep "feature/" | xargs git branch -D 2>/dev/null || true

# Check for leftover test files
git status

# Reset if needed
git checkout main
git clean -fd  # Remove untracked files (careful!)</pre>
            </div>
        </div>
    </div>

    <h2>Test Results Summary</h2>

    <table class="summary-table" id="results-table">
        <thead>
            <tr>
                <th>Test</th>
                <th>Status</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>TEST 1: Worker Spawn</td><td id="result-1">-</td><td></td></tr>
            <tr><td>TEST 2: Claim & Heartbeat</td><td id="result-2">-</td><td></td></tr>
            <tr><td>TEST 3: Manager Signals</td><td id="result-3">-</td><td></td></tr>
            <tr><td>TEST 4: Clean Auto-Merge</td><td id="result-4">-</td><td></td></tr>
            <tr><td>TEST 5: Conflict Detection</td><td id="result-5">-</td><td></td></tr>
            <tr><td>TEST 6: Conflict Resolution</td><td id="result-6">-</td><td></td></tr>
            <tr><td>TEST 7: Dead Worker Detection</td><td id="result-7">-</td><td></td></tr>
            <tr><td>TEST 8: MCP Worker Tools</td><td id="result-8">-</td><td></td></tr>
            <tr><td>TEST 9: UI Components</td><td id="result-9">-</td><td></td></tr>
            <tr><td>TEST 10: Parallel Workers</td><td id="result-10">-</td><td></td></tr>
        </tbody>
    </table>

    <h2>Issues Found</h2>
    <textarea class="notes-area" id="issues-found" placeholder="Document any issues discovered during testing..."></textarea>

    <h2>Recommendations</h2>
    <textarea class="notes-area" id="recommendations" placeholder="Post-testing recommendations..."></textarea>

    <div style="margin-top: 30px; text-align: center;">
        <button class="btn btn-secondary" onclick="exportResults()">Export Results</button>
        <button class="btn btn-danger" onclick="resetAll()">Reset All Tests</button>
    </div>

    <script>
        // Test state
        const testResults = {};

        function toggleTest(header) {
            const card = header.closest('.test-card');
            card.classList.toggle('expanded');
        }

        function markTest(testNum, status) {
            testResults[testNum] = status;

            // Update status badge
            const badge = document.getElementById(`status-${testNum}`);
            badge.className = `test-status status-${status}`;
            badge.textContent = status.charAt(0).toUpperCase() + status.slice(1);

            // Update result table
            const resultCell = document.getElementById(`result-${testNum}`);
            if (status === 'pass') {
                resultCell.innerHTML = '<span style="color: #7ee787;">PASS</span>';
            } else if (status === 'fail') {
                resultCell.innerHTML = '<span style="color: #f85149;">FAIL</span>';
            } else {
                resultCell.innerHTML = '-';
            }

            // Update progress
            updateProgress();

            // Save to localStorage
            saveState();
        }

        function updateProgress() {
            const completed = Object.values(testResults).filter(s => s === 'pass' || s === 'fail').length;
            const passed = Object.values(testResults).filter(s => s === 'pass').length;

            document.getElementById('tests-completed').textContent = completed;
            document.getElementById('overall-progress').style.width = `${completed * 10}%`;
        }

        function saveState() {
            const state = {
                results: testResults,
                issues: document.getElementById('issues-found').value,
                recommendations: document.getElementById('recommendations').value,
                notes: {}
            };

            document.querySelectorAll('.notes-area').forEach((textarea, i) => {
                if (textarea.id !== 'issues-found' && textarea.id !== 'recommendations') {
                    state.notes[i] = textarea.value;
                }
            });

            localStorage.setItem('multiWorkerTestState', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('multiWorkerTestState');
            if (saved) {
                const state = JSON.parse(saved);

                // Restore test results
                Object.entries(state.results || {}).forEach(([testNum, status]) => {
                    markTest(parseInt(testNum), status);
                });

                // Restore issues and recommendations
                if (state.issues) {
                    document.getElementById('issues-found').value = state.issues;
                }
                if (state.recommendations) {
                    document.getElementById('recommendations').value = state.recommendations;
                }

                // Restore notes
                const textareas = document.querySelectorAll('.notes-area');
                Object.entries(state.notes || {}).forEach(([i, value]) => {
                    if (textareas[i]) {
                        textareas[i].value = value;
                    }
                });
            }
        }

        function resetAll() {
            if (confirm('Reset all test results? This cannot be undone.')) {
                localStorage.removeItem('multiWorkerTestState');
                location.reload();
            }
        }

        function exportResults() {
            const passed = Object.values(testResults).filter(s => s === 'pass').length;
            const failed = Object.values(testResults).filter(s => s === 'fail').length;
            const pending = 10 - passed - failed;

            let report = `# Multi-Worker System Test Results\n`;
            report += `Date: ${new Date().toISOString()}\n\n`;
            report += `## Summary\n`;
            report += `- Passed: ${passed}/10\n`;
            report += `- Failed: ${failed}/10\n`;
            report += `- Pending: ${pending}/10\n\n`;
            report += `## Results\n`;

            for (let i = 1; i <= 10; i++) {
                const status = testResults[i] || 'pending';
                const icon = status === 'pass' ? '[x]' : status === 'fail' ? '[-]' : '[ ]';
                report += `${icon} TEST ${i}: ${status.toUpperCase()}\n`;
            }

            report += `\n## Issues Found\n${document.getElementById('issues-found').value || 'None documented'}\n`;
            report += `\n## Recommendations\n${document.getElementById('recommendations').value || 'None documented'}\n`;

            // Download as file
            const blob = new Blob([report], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `multi-worker-test-results-${new Date().toISOString().split('T')[0]}.md`;
            a.click();
        }

        // Auto-save notes on change
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('notes-area')) {
                saveState();
            }
        });

        // Handle checkbox state
        document.addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                e.target.closest('li')?.classList.toggle('checked', e.target.checked);
            }
        });

        // Load saved state on page load
        loadState();
    </script>
</body>
</html>

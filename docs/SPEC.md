# chkd v2 Specification

> Organized by **system area** rather than build phase.
> The spec is both the todo list and the map of what exists.

<!-- âš ï¸ CLAUDE: Do NOT edit this file directly! Use chkd CLI commands:
     - chkd add "feature" - Add new items
     - chkd tick "item"   - Mark items complete
     - chkd working "item" - Mark items in-progress
     This keeps the UI in sync and tracks changes properly. -->

---

## Overview

**chkd** is a development workflow system that makes AI-assisted development structured and consistent.

**Core idea**: Plan in one place (UI), build in another (terminal). The spec is the source of truth.

---

## Site Design

> How chkd looks and feels. Pages, layouts, user flows.

### Pages

#### Guide (`/guide`)
How to use chkd - workflow explanation, commands, troubleshooting.

**Status**: Docs exist, UI page needed
- [x] **SD.1 Guide Documentation** - docs/GUIDE.md created
- [x] **SD.2 Guide Page** - Svelte page at /guide route
  - [x] Workflow diagram
  - [x] Session lifecycle visual
  - [x] Quick reference cards
  - [x] Troubleshooting section

#### Command Center (`/`)
The main workspace. Shows current task, story list, progress.

**Status**: Not started
- [ ] **SD.3 Command Center Layout** - Main page structure
  - [ ] Current task card (pinned at top)
  - [ ] Story list sidebar
  - [ ] Story detail panel
  - [ ] Progress overview

#### Settings (`/settings`)
Configure repos and preferences.

**Status**: Not started
- [ ] **SD.4 Settings Page** - Basic settings
  - [ ] Repository path configuration
  - [ ] Theme toggle (dark/light)

### Design System

- [ ] **SD.5 CSS Variables** - Color system, spacing, typography
- [ ] **SD.6 Component Styles** - Buttons, cards, inputs
- [x] **SD.7 Dark Mode** - Full dark theme support
- [x] **SD.8 Queue List for Off-Task Items** - Capture todos during active session, surface on tick with instructions for Claude to add to internal todo
  - [x] Queue input in task card (visible during active session)
  - [x] Queued item count badge
  - [x] Remove items before tick
  - [x] POST /api/session/queue - Add item
  - [x] GET /api/session/queue - List items
  - [x] DELETE /api/session/queue/:id - Remove item
  - [x] Update tick response to include queued items + instructions
  - [x] Auto-clear queue after surfacing
- [ ] [P1] **SD.9 Update the specfile template to have note stopping claude directly editing it.** - Force the use of the endpoints for spec update.  Also should look at claude file genreally and give a better overview of chkd and the calls to make - noting in the ci calls


> As a user, I want to have a specfile template that prevents me from directly editing it, so that I can ensure consistency and avoid unintentional changes.
  - [x] Explore: understand problem, search existing functions
  - [x] Design: flow diagram if needed
  - [x] Prototype: backend with test data + frontend calling it
  - [x] Feedback: user reviews prototype
  - [x] Implement: replace test data with real logic
  - [x] Polish: iterate based on usage
- [x] **SD.9 Test Queue Feature** - Dummy task for testing the queue feature
- [x] **SD.10 Test Queue Feature** - Dummy task for testing queue
  - [x] Explore: understand problem, search existing functions
  - [x] Design: flow diagram if needed
  - [x] Prototype: backend with test data + frontend calling it
  - [x] Feedback: user reviews prototype
  - [~] Implement: replace test data with real logic
  - [ ] Polish: iterate based on usage
- [x] **SD.11 Can we add a task to replace the drop-down menu for swapping the repose I'm imagining a set of cards that run across the top they have a bit of information about the repo and what's developing where it's at like a very condensed high-level and you can click between them really easily and they're showing you what each one's working on at the moment or if it's idle** - The cards will run across the top of the screen, displaying details like the repository name, what's currently being developed, and the overall status.

> As a product manager, I want a set of cards that show high-level information about each repository so that I can easily see what's being worked on and the status of each area. You can click them to nav between them
  - [x] Explore: understand problem, search existing functions
  - [x] Design: flow diagram if needed
  - [x] Prototype: backend with test data + frontend calling it
  - [x] Feedback: user reviews prototype
  - [x] Implement: replace test data with real logic
  - [x] Polish: iterate based on usage
  - [x] Allow quick message to the queue that gets pulled in on the next "click"
  - [x] Add ability to receive a message when Claude asked multi questions and is blocking to continue you could handle it in the app
  - [x] Connect blocking questions UI to embedded terminal (after SD.12)
- [x] **SD.12 Embedded Terminal** - Add xterm.js terminal to chkd UI with tmux backend for session persistence. Can run Claude Code directly in the web app, survives page refresh, can also attach from regular terminal.
  - [x] Explore: xterm.js, node-pty, tmux integration
  - [x] Design: terminal panel layout in UI
  - [x] Prototype: xterm.js + WebSocket + node-pty
  - [x] Add tmux session management (create/attach/reattach)
  - [x] Handle page refresh reconnection
  - [x] Polish: resize handling, styling, keyboard shortcuts
  - [!] Future: Connect blocking questions API to terminal events
  - [!] Fix terminal overflow/cropping issue (tmux status bar leaks outside container)
- [x] **SD.13 add instrcutions into the Philosophy to use for bug fix when getting bugs, add apply to size the bug big or small using different approaches** - The feature will allow developers to include instructions in the Philosophy section of the application to provide guidance on how to approach and fix bugs, as well as provide tools to help assess the size and complexity of the bug.

> As a developer, I want to be able to add instructions into the Philosophy section to help with bug fixes, and be able to apply different approaches to size the bug as small or large, so that I can more effectively resolve issues.
  - [x] Explore: understand problem, search existing functions
  - [ ] Design: flow diagram if needed
  - [~] Prototype: backend with test data + frontend calling it
  - [ ] Feedback: user reviews prototype
  - [ ] Implement: replace test data with real logic
  - [ ] Polish: iterate based on usage
- [x] **SD.14 Can we add a list somewhere of quick wins I think maybe on the card you can click in it just opens similar to bugs and you can just bang it in there and you can tell the AI just took it through the quick wins** - The quick wins list should be accessible from the card view, allowing users to easily log and view items that can be quickly addressed.

> As a user, I want a quick wins list that I can easily access and add to, so that I can quickly capture and surface potential improvements.
  - [x] Explore: research problem, check existing code/patterns
  - [x] Design: plan approach + define endpoint contracts
  - [x] Prototype: build UI with mock data, stub backend
  - [x] Feedback: user reviews and approves UX
  - [x] Implement: connect real backend logic
  - [x] Polish: error states, edge cases, performance
- [ ] **SD.15 Expose a lot of the helper prompts in the settings especially the messages that get past the AI on return of the API calls to the CLI and the LLM helper for creating add and bugs** - This feature will allow users to view and manage the helper prompts that are used to generate API responses, improving transparency and control.

> As a user, I want to expose helper prompts in the settings so that I can better understand the AI's behavior and responses both returned to the CLI & the prompt& spec builder
  - [x] Explore: research problem, check existing code/patterns
  - [ ] Design: plan approach + define endpoint contracts
  - [ ] Prototype: build UI with mock data, stub backend
  - [ ] Feedback: user reviews and approves UX
  - [ ] Implement: connect real backend logic
  - [ ] Polish: error states, edge cases, performance
- [x] **Track and display time spent on each checklist item - store duration when ticked, show in UI**
  - [x] Explore: check existing checklist data structure + timing patterns
  - [x] Design: duration storage schema + UI display mockups
  - [~] Prototype: timer UI + mock duration data display
  - [ ] Feedback: user tests timing UX and display format
  - [ ] Implement: real duration tracking + database storage
  - [ ] Polish: pause/resume states + duration formatting
- [x] **FE Terminal WebSocket connection - investigate why terminal shows disconnected and fix**
  - [x] Explore: check WebSocket connection logs and existing terminal code
  - [x] Design: identify connection failure points and reconnection strategy
  - [x] Prototype: test WebSocket with mock terminal data
  - [x] Feedback: verify connection stability in test environment
  - [x] Implement: fix connection issues and add proper error handling
  - [x] Polish: add connection status indicators and auto-reconnect
- [ ] **SD.16 allow a file to be added into a bug or sotry** - Enable users to attach files (documents, images, logs, etc.) to bug reports and stories for better context and documentation.

> As a developer, I want to attach files to bugs and stories so that I can provide additional context like screenshots, logs, or documentation.
  - [ ] Explore: research problem, check existing code/patterns
  - [ ] Design: plan approach + define endpoint contracts
  - [ ] Prototype: build UI with mock data, stub backend
  - [ ] Feedback: user reviews and approves UX
  - [ ] Implement: connect real backend logic
  - [ ] Polish: error states, edge cases, performance
- [x] **SD.17 add impromptu and debug work states so the UI is always engaged regardless** - At the moment it can be idle in the app but actually the code is working so we're looking to solve those solutions both when in debug and impromptu work

> As a developer, I want impromptu and debug work states so that the UI stays engaged during all types of work sessions.
  - [x] Explore: research problem, check existing code/patterns
  - [x] Design: plan approach + define endpoint contracts
  - [x] Prototype: build UI with mock data, stub backend
  - [x] Feedback: user reviews and approves UX
  - [x] review overall code around this update for simplification if possible
  - [x] Implement: connect real backend logic
  - [x] Polish: error states, edge cases, performance
- [ ] **SD.18 allow file to be attached when creating bug or story** - Enable users to attach files (documents, images, logs, etc.) to bug reports and user stories for better context and documentation.

> As a developer, I want to attach files to bugs and stories so that I can provide additional context like screenshots, logs, or documentation.
  - [ ] Explore: research problem, check existing code/patterns
  - [ ] Design: plan approach + define endpoint contracts
  - [ ] Prototype: build UI with mock data, stub backend
  - [ ] Feedback: user reviews and approves UX
  - [ ] Implement: connect real backend logic
  - [ ] Polish: error states, edge cases, performance

---

## Frontend

> Svelte components, stores, client-side logic.

### Core Components

#### CurrentTaskCard
Shows active task status, progress, actions.

**Status**: Not started
- [ ] **FE.1 CurrentTaskCard Component**
  - [ ] Status badge (idle/building/testing/complete)
  - [ ] Progress bar
  - [ ] Task name and description
  - [ ] Time elapsed

#### StoryList
Collapsible list of areas and stories.

**Status**: Not started
- [ ] **FE.2 StoryList Component**
  - [ ] Area grouping (expandable)
  - [ ] Story selection
  - [ ] Progress percentages
  - [ ] Status indicators

#### StoryDetail
Full story view with checklist.

**Status**: Not started
- [ ] **FE.3 StoryDetail Component**
  - [ ] User story display
  - [ ] Checklist rendering
  - [ ] Item status toggling
  - [ ] Description/notes

#### FeatureCapture
Add new features to the spec.

**Status**: Not started
- [ ] **FE.4 FeatureCapture Component**
  - [ ] Feature title input
  - [ ] Area selection (Site Design / Frontend / Backend)
  - [ ] Workflow template auto-added
  - [ ] Duplicate detection

### State Management

- [ ] **FE.5 Stores** - Svelte stores for app state
  - [ ] Session state
  - [ ] Spec data
  - [ ] UI preferences

### Client API

- [ ] **FE.6 API Client** - Functions to call backend
  - [ ] Fetch wrapper with error handling
  - [ ] Type-safe responses
- [ ] [P1] **FE.7 Update the top Session ui to show other sessions in deveopment from other projects if many working at the same time.** - If I'm coding several different projects no matter what project file I'm looking at an easy way to toggle on and showing a summarised version of what that's up to as I go around the project but if I'm the master project then I'm looking at is still the main visible one at the time

> As a developer, I want to see other sessions in development from other projects if many are working at the same time, so that I can better collaborate and understand the overall context.
  - [ ] Explore: understand problem, search existing functions
  - [ ] Design: flow diagram if needed
  - [ ] Prototype: backend with test data + frontend calling it
  - [ ] Feedback: user reviews prototype
  - [ ] Implement: replace test data with real logic
  - [ ] Polish: iterate based on usage
- [ ] **FE.7 Allow to set tags and priority when creating a story and it's tasks** - This feature will allow users to add tags and set priority levels for stories and tasks, enabling more efficient task management and organization.

> As a user, I want to be able to set tags and priority when creating a story and its tasks so that I can better organize and prioritize my work.
  - [ ] Explore: research problem, check existing code/patterns
  - [ ] Design: plan approach + define endpoint contracts
  - [ ] Prototype: build UI with mock data, stub backend
  - [ ] Feedback: user reviews and approves UX
  - [ ] Implement: connect real backend logic
  - [ ] Polish: error states, edge cases, performance
- [!] **FE.8 Redesign how the terminal fits into the app UI I think it should be 50-50 columns with the work list to fill that column currently at sort of floating or something** - Currently the terminal appears to be floating. Should be restructured as a proper column layout sharing space equally with the work list. BLOCKED: tmux status bar overflow/cropping not fully resolved, need different approach.

> As a developer, I want the terminal and work list in a 50-50 column layout so that I can efficiently view both simultaneously without overlapping UI elements.
  - [x] Explore: research problem, check existing code/patterns
  - [x] Design: plan approach + define endpoint contracts
  - [x] Prototype: build UI with mock data, stub backend
  - [x] Feedback: user reviews and approves UX
  - [x] Implement: connect real backend logic
  - [!] Polish: overflow/cropping issue with tmux status bar needs different approach

---

## Backend

> SvelteKit server - APIs, database, services.

### Session API

Tracks current work context.

**Status**: Complete
- [x] **BE.1 Session Endpoints**
  - [x] `GET /api/session` - Current session
  - [x] `GET /api/status` - Human-friendly status
  - [x] `POST /api/session/start` - Begin task
  - [x] `POST /api/session/complete` - Mark task done
  - [x] `POST /api/session/check` - Validate if on-plan

### Spec API

Manage the specification document.

**Status**: Complete
- [x] **BE.2 Spec Endpoints**
  - [x] `GET /api/spec/full` - Parsed spec structure
  - [x] `POST /api/spec/tick` - Toggle item status
  - [x] `POST /api/spec/add` - Add new feature (with workflow template)

### Repository API

Manage repo configuration.

**Status**: Complete
- [x] **BE.3 Repo Endpoints**
  - [x] `GET /api/repos` - List repos
  - [x] `POST /api/repos` - Add repo

### Bug Queue API

Track bugs for later.

**Status**: Complete
- [x] **BE.4 Bug Endpoints**
  - [x] `GET /api/bugs` - List bugs
  - [x] `POST /api/bugs` - Add bug

### Core Services

#### Spec Parser
Parses SPEC.md into structured data.

**Status**: Complete
- [x] **BE.5 Spec Parser** - `src/lib/server/spec/parser.ts`
  - [x] Area/item extraction
  - [x] User story capture
  - [x] Progress calculation
  - [x] Format validation

#### Spec Writer
Modifies SPEC.md programmatically.

**Status**: Complete
- [x] **BE.6 Spec Writer** - `src/lib/server/spec/writer.ts`
  - [x] Mark items complete/incomplete
  - [x] Add new items
  - [x] Add workflow template sub-items
  - [x] Update status emojis (with unicode fix)

### Database

SQLite via better-sqlite3.

**Status**: Complete
- [x] **BE.7 Database Layer** - `src/lib/server/db/`
  - [x] Schema (repos, sessions, bugs)
  - [x] Query functions

### CLI

Command-line interface with workflow documentation.

**Status**: Complete
- [x] **BE.8 CLI** - `src/cli/index.ts`
  - [x] status, start, tick, done commands
  - [x] check, add, bug commands
  - [x] workflow command (shows diagram)
  - [x] help command
- [x] **BE.9 Session & Task Management Improvements** - Simple session control and task editing.

> As a user, I want better control over sessions and ability to edit task details.
  - [x] Explore: understand problem, search existing functions
  - [x] Design: flow diagram if needed
  - [x] Prototype: backend with test data + frontend calling it
  - [x] `chkd idle` command - manually return session to idle
  - [x] Editable task title/description in detail popout
  - [x] Timer per task (track time on each)
  - [x] Fix main timer not resetting for each story
  - [x] Feedback: user reviews prototype
  - [x] Implement: connect real logic
  - [x] Polish: edge cases
- [x] [P1] **BE.10 Sync/Distribution System** - Auto-sync chkd skills, CLAUDE.md sections, and config to other projects using chkd

> As a developer, I want chkd updates to automatically roll out to all my projects so that every Claude instance has the latest workflow instructions and skills.
  - [x] Explore: what files need syncing (.claude/skills/*, CLAUDE.md, etc.)
  - [x] Design: manifest file listing syncable assets + versioning
  - [x] `chkd init` - Initialize chkd in a new project (copies skills, creates CLAUDE.md section)
  - [x] `chkd sync` - Pull latest from chkd source to current project
  - [x] `chkd sync --all` - Sync to all registered repos
  - [x] Version tracking in each project (.chkd-version or similar)
  - [x] Handle merge conflicts (project customizations vs chkd updates)
  - [ ] Optional: auto-sync on `npm update chkd` or git hook
- [ ] **BE.10 Add version tracking to the CLI app - automatic updating - dont need to remeber** - The version tracking feature will allow users to view the version history of the CLI app, including details on what changes were made in each update.

> As a developer, I want to add version tracking to the CLI app so that I can easily see the history of changes made to the application.
  - [ ] Explore: understand problem, search existing functions
  - [ ] Implement: replace test data with real logic
  - [ ] Polish: iterate based on usage
- [ ] **BE.11 Add working pusle check message to bacd end** - Allow the AI to call a pulse with the state that it's still in just as a nice signal to the back end that we're still on track if there's a mismatch on the state of the platform and the the AI sending we can give it a little message and help get back on track

> As a developer, I want a health check endpoint so that I can monitor if the backend service is running properly.
  - [ ] Explore: research problem, check existing code/patterns
  - [ ] Design: plan approach + define endpoint contracts
  - [ ] Feedback: user reviews and approves UX
  - [ ] Implement: connect real backend logic
  - [ ] Polish: error states, edge cases, performance
  - [ ] update documention & guides
- [ ] **BE.12 Update Bug Workflow** - âŽ¿ Â   chkd bug "description" [--severity high|medium|low|critical]             
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            
                                                                                
       Quick-create a bug with minimal friction.                                
                                                                                
       OPTIONS:                                                                 
         --severity <level>   Set severity (default: medium)                    
                              Levels: critical, high, medium, low               
                                                                                
       WHEN TO USE:                                                             
         - You notice something broken while working                            
         - User reports an issue                                                
         - Test fails unexpectedly                                              
         - You want to track something for later                                
                                                                                
       EXAMPLES:                                                                
         chkd bug "Save button broken"                                          
         chkd bug "Login fails on mobile" --severity high                       
         chkd bug "Typo in footer" --severity low                               
         chkd bug "App crashes on startup" --severity critical                  
                                                                                
       NEXT STEPS:                                                              
         - Run 'chkd bugs' to see all bugs                                      
         - Use '/bugfix' in Claude Code to fix a bug systematically             
                                                                                
       TIP: Keep descriptions short but specific.        We need to update starting a bug making it more simple this should be add,

> Currently getting confused creating a bug rather then working on the bug simplgy
  - [ ] Explore: research problem, check existing code/patterns
  - [ ] Design: plan approach + define endpoint contracts
  - [ ] Prototype: build UI with mock data, stub backend
  - [ ] Feedback: user reviews and approves UX
  - [ ] Implement: connect real backend logic
  - [ ] Polish: error states, edge cases, performance
  - [ ] update documention and guides

---

## Future Areas

> Not yet started. Organized by what they'll touch.

### Quality Features (v3+)
- [ ] **FUT.1 Test Generation** - Auto-generate tests on commit (port from v1)
- [ ] **FUT.2 Sceptic Check** - Validate ideas before building
- [ ] **FUT.3 Quality Gates** - Block bad code from main

### Git & Source Control (UI owns this)
- [ ] **FUT.4 Diff View** - See what changed during session
- [ ] **FUT.5 Staging UI** - Select files to commit
- [ ] **FUT.6 Commit Flow** - Pre-fill message from session, commit
- [ ] **FUT.7 Push to Remote** - Push when ready
- [ ] **FUT.8 Audit Trail** - History of commits per session

### Advanced Features
- [ ] **FUT.9 WebSocket Updates** - Real-time UI updates
- [ ] **FUT.10 Version History** - Track spec changes over time

---

## Reference

### Workflow Template

Every feature added gets these steps:
```
- [ ] Explore: understand problem, search existing functions
- [ ] Design: flow diagram if needed
- [ ] Prototype: backend with test data + frontend calling it
- [ ] Feedback: user reviews prototype
- [ ] Implement: replace test data with real logic
- [ ] Polish: iterate based on usage
```

### Spec Format Rules

- Area header: `## Area Name` or `### Sub-Area`
- Section numbers: `**XX.N Feature Name**` (e.g., BE.1, FE.2)
- Checklist: `- [ ]` or `- [x]`
- User story: Blockquote `>`
- Status line: `**Status**: Complete/In Progress/Not started`

### Design Standards

- Colors: CSS variables (`--primary`, `--success`, etc.)
- Border radius: 6px inputs, 8px buttons, 12px cards
- Spacing: 4px base (4, 8, 12, 16, 24, 32)
- Status emoji: âœ… complete, ðŸš§ in-progress, ðŸ“‹ pending

### Code Standards

- Files: `kebab-case.ts`
- Classes: `PascalCase`
- Functions: `camelCase`
- API responses: `{ success, data?, error? }`

---

## Skills

Available Claude Code skills:

| Skill | Purpose |
|-------|---------|
| `/chkd` | Build mode - check session, implement tasks with polish |
| `/bugfix` | Fix bugs without feature creep - research first |
| `/story` | Develop stories - assess, question, refine specs |
| `/spec-check` | Validate SPEC.md format after editing |

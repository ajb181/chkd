<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Quality Tools Research</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #fafafa;
      color: #333;
    }
    h1 {
      color: #1a1a1a;
      border-bottom: 3px solid #4f46e5;
      padding-bottom: 10px;
    }
    h2 {
      color: #4f46e5;
      margin-top: 50px;
      border-bottom: 1px solid #e5e5e5;
      padding-bottom: 8px;
    }
    h3 {
      color: #1a1a1a;
      margin-top: 30px;
    }
    .subtitle {
      color: #666;
      font-size: 1.2em;
      margin-top: -10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #4f46e5;
      color: white;
      font-weight: 600;
    }
    tr:hover { background: #f9f9f9; }
    code {
      background: #e8e8e8;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.9em;
    }
    pre {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.9em;
    }
    pre code {
      background: none;
      padding: 0;
      color: inherit;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .card h3 {
      margin-top: 0;
      color: #4f46e5;
    }
    .workflow-box {
      background: #1e1e1e;
      color: #d4d4d4;
      border-radius: 8px;
      padding: 20px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.85em;
      white-space: pre;
      overflow-x: auto;
      line-height: 1.5;
    }
    .highlight { color: #4fc3f7; }
    .user { color: #81c784; }
    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 20px 0;
    }
    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 20px 0;
    }
    .dont {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 20px 0;
    }
    .tag {
      display: inline-block;
      background: #4f46e5;
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8em;
      margin-right: 8px;
    }
    .tag.green { background: #28a745; }
    .tag.orange { background: #fd7e14; }
    .tag.gray { background: #6c757d; }
    a { color: #4f46e5; }
    hr {
      border: none;
      border-top: 1px solid #e5e5e5;
      margin: 40px 0;
    }
    .tldr {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      color: white;
      border-radius: 12px;
      padding: 24px;
      margin: 30px 0;
    }
    .tldr h3 { color: white; margin-top: 0; }
    .tldr code { background: rgba(255,255,255,0.2); color: white; }
  </style>
</head>
<body>

  <h1>Code Quality Tools Research</h1>
  <p class="subtitle">A simple guide to checking code health before and after tasks.</p>

  <hr>

  <h2>The Problem We're Solving</h2>

  <p>When you start a task, you might be about to build on top of messy code. It would be nice to know that <em>before</em> you start, so you can choose to clean it up first.</p>

  <p>When you finish a task, you might have introduced some messiness. It would be nice to catch that and log it as future refactoring work.</p>

  <div class="success">
    <strong>Goal:</strong> Simple quality checks that fit our workflow. Team of one + AI.
  </div>

  <hr>

  <h2>What "Code Quality" Actually Means</h2>
  <p>Here's what the tools check for, in plain English:</p>

  <table>
    <tr>
      <th>Term</th>
      <th>What It Means</th>
      <th>Why It Matters</th>
    </tr>
    <tr>
      <td><strong>Complexity</strong></td>
      <td>How many paths through the code (if/else, loops, etc.)</td>
      <td>Hard to read = hard to change</td>
    </tr>
    <tr>
      <td><strong>Duplication</strong></td>
      <td>Copy-pasted code</td>
      <td>Fix a bug in one place, miss the copies</td>
    </tr>
    <tr>
      <td><strong>Long functions</strong></td>
      <td>Functions doing too much</td>
      <td>Should be split into smaller pieces</td>
    </tr>
    <tr>
      <td><strong>Magic numbers</strong></td>
      <td>Random numbers like <code>if (x > 42)</code></td>
      <td>What does 42 mean? Use a named constant</td>
    </tr>
    <tr>
      <td><strong>Dead code</strong></td>
      <td>Code that's never used</td>
      <td>Confusing clutter</td>
    </tr>
    <tr>
      <td><strong>Coupling</strong></td>
      <td>Everything depends on everything</td>
      <td>Change one thing, break ten others</td>
    </tr>
  </table>

  <hr>

  <h2>The Tools (Simplest to Most Complex)</h2>

  <div class="card">
    <h3>1. jscpd - Copy/Paste Detector</h3>
    <p><span class="tag green">Zero Config</span> <span class="tag">Recommended</span></p>

    <p><strong>What it does:</strong> Finds duplicated code blocks.</p>

    <p><strong>How to run:</strong></p>
    <pre><code>npx jscpd ./src --min-lines 5</code></pre>

    <p><strong>Output:</strong></p>
    <pre><code>Found 3 clones with 120 duplicated lines in 15 files</code></pre>

    <p><strong>Good for:</strong> Quick check before/after tasks.</p>
  </div>

  <div class="card">
    <h3>2. Knip - Dead Code Finder</h3>
    <p><span class="tag green">Zero Config</span></p>

    <p><strong>What it does:</strong> Finds unused files, exports, and dependencies.</p>

    <p><strong>How to run:</strong></p>
    <pre><code>npx knip</code></pre>

    <p><strong>Output:</strong></p>
    <pre><code>Unused files: src/old-utils.ts
Unused exports: formatDate in src/utils.ts
Unused dependencies: lodash</code></pre>

    <p><strong>Good for:</strong> Cleaning up cruft. Run occasionally.</p>
  </div>

  <div class="card">
    <h3>3. ESLint Rules (Specific Checks)</h3>
    <p><span class="tag orange">Medium Setup</span></p>

    <p><strong>What it does:</strong> Catches specific patterns you define as "bad."</p>

    <p><strong>Useful rules:</strong></p>
    <ul>
      <li><code>max-lines-per-function</code> - Flag long functions</li>
      <li><code>no-magic-numbers</code> - Flag unexplained numbers</li>
      <li><code>complexity</code> - Flag complex functions</li>
    </ul>

    <p><strong>How to run:</strong></p>
    <pre><code>npx eslint src/ --rule 'complexity: ["warn", 10]'</code></pre>

    <p><strong>Good for:</strong> Ongoing enforcement. Set up once, runs forever.</p>
  </div>

  <div class="card">
    <h3>4. Code Health Meter - Full Dashboard</h3>
    <p><span class="tag green">Zero Config</span> <span class="tag gray">Slow</span></p>

    <p><strong>What it does:</strong> Comprehensive health report with scores.</p>

    <p><strong>How to run:</strong></p>
    <pre><code>npx code-health-meter --srcDir ./src --outputDir ./report --format html</code></pre>

    <p><strong>Output:</strong> HTML report with maintainability score, complexity per file, duplication %, coupling analysis, visual graphs.</p>

    <p><strong>Good for:</strong> Periodic deep-dive. Not every task.</p>
  </div>

  <hr>

  <h2>How This Fits Our Workflow</h2>

  <h3>Before Starting a Task (Explore Phase)</h3>

  <div class="workflow-box">┌─────────────────────────────────────────────┐
│  <span class="user">You: /chkd SD.5</span>                            │
│                                             │
│  <span class="highlight">Claude:</span> Starting Explore phase...          │
│          Let me check the files we'll touch │
│                                             │
│  [Runs: npx jscpd src/routes/api/]          │
│                                             │
│  <span class="highlight">Claude:</span> Found 45 duplicated lines in       │
│          api/session.ts and api/task.ts     │
│                                             │
│          Want to refactor first, or         │
│          proceed and log it for later?      │
│                                             │
│  <span class="user">You: Log it, let's proceed</span>                 │
│                                             │
│  [chkd bug "Duplication in session/task"]   │
└─────────────────────────────────────────────┘</div>

  <p><strong>The key:</strong> You decide. Claude flags, doesn't force.</p>

  <h3>After Finishing a Task</h3>

  <div class="workflow-box">┌─────────────────────────────────────────────┐
│  <span class="user">You: Done with the feature</span>                 │
│                                             │
│  <span class="highlight">Claude:</span> Nice! Quick quality check...       │
│                                             │
│  [Runs: npx jscpd src/routes/api/]          │
│                                             │
│  <span class="highlight">Claude:</span> New duplication detected:          │
│          handleError() duplicated 3 times   │
│                                             │
│          Want me to refactor now, or        │
│          log it as a quick win?             │
│                                             │
│  <span class="user">You: Log it</span>                                │
│                                             │
│  [chkd win "Extract shared handleError()"]  │
└─────────────────────────────────────────────┘</div>

  <hr>

  <h2>My Recommendation</h2>

  <div class="tldr">
    <h3>Start Simple (Week 1)</h3>
    <p>Just use <strong>jscpd</strong> manually when you want a quick check:</p>
    <pre><code>npx jscpd ./src --min-lines 5</code></pre>
    <p>That's it. No setup. Run it when you're curious.</p>
  </div>

  <h3>Add to Workflow (Week 2+)</h3>
  <p>Create a simple npm script:</p>
  <pre><code>{
  "scripts": {
    "health": "npx jscpd ./src --min-lines 5 && npx knip"
  }
}</code></pre>

  <p>Then just:</p>
  <pre><code>npm run health</code></pre>

  <h3>Optional: Add to /code-health Skill</h3>
  <p>A skill that Claude runs during Explore phase:</p>
  <ol>
    <li>Check files that will be touched</li>
    <li>Run jscpd on those files</li>
    <li>Report findings</li>
    <li>Let user decide: proceed or refactor first</li>
  </ol>
  <p><strong>Not a gate.</strong> Not blocking. Just information.</p>

  <hr>

  <h2>What NOT To Do</h2>

  <div class="dont">
    <ul style="margin: 0; padding-left: 20px;">
      <li><strong>Don't add SonarQube</strong> - Overkill for team of one</li>
      <li><strong>Don't add 10 ESLint plugins</strong> - Noise, not signal</li>
      <li><strong>Don't make it a gate</strong> - You decide, not the tool</li>
      <li><strong>Don't run full reports every task</strong> - Too slow, too much info</li>
    </ul>
  </div>

  <hr>

  <h2>Integration Points in chkd</h2>

  <table>
    <tr>
      <th>When</th>
      <th>What to Check</th>
      <th>Tool</th>
      <th>Action</th>
    </tr>
    <tr>
      <td>Explore phase</td>
      <td>Files we'll touch</td>
      <td>jscpd</td>
      <td>Flag duplication, let user decide</td>
    </tr>
    <tr>
      <td>After Implement</td>
      <td>New code we wrote</td>
      <td>jscpd</td>
      <td>Catch new duplication</td>
    </tr>
    <tr>
      <td>Weekly/Monthly</td>
      <td>Whole codebase</td>
      <td>knip + code-health-meter</td>
      <td>Deep clean</td>
    </tr>
  </table>

  <hr>

  <h2>The Commands You Need</h2>

  <pre><code># Quick duplication check
npx jscpd ./src --min-lines 5

# Find dead code
npx knip

# Full health report (occasional)
npx code-health-meter --srcDir ./src --outputDir ./report --format html

# Check specific complexity (needs eslint)
npx eslint src/ --rule 'complexity: ["warn", 10]'</code></pre>

  <hr>

  <h2>Summary</h2>

  <table>
    <tr>
      <th>Tool</th>
      <th>What</th>
      <th>When</th>
      <th>Effort</th>
    </tr>
    <tr>
      <td><strong>jscpd</strong></td>
      <td>Duplication</td>
      <td>Every task</td>
      <td><span class="tag green">Zero</span></td>
    </tr>
    <tr>
      <td><strong>knip</strong></td>
      <td>Dead code</td>
      <td>Weekly</td>
      <td><span class="tag green">Zero</span></td>
    </tr>
    <tr>
      <td><strong>code-health-meter</strong></td>
      <td>Full report</td>
      <td>Monthly</td>
      <td><span class="tag green">Zero</span></td>
    </tr>
    <tr>
      <td><strong>eslint rules</strong></td>
      <td>Specific patterns</td>
      <td>Always on</td>
      <td><span class="tag orange">Medium</span></td>
    </tr>
  </table>

  <div class="success">
    <strong>Start with jscpd.</strong> It's the highest value for lowest effort. One command, immediate insight.
  </div>

  <hr>

  <h2>Sources</h2>
  <ul>
    <li><a href="https://github.com/kucherenko/jscpd">jscpd - Copy/Paste Detector</a></li>
    <li><a href="https://knip.dev">Knip - Dead Code Finder</a></li>
    <li><a href="https://github.com/helabenkhalfallah/code-health-meter">Code Health Meter</a></li>
    <li><a href="https://eslint.org/docs/latest/extend/custom-rules">ESLint Custom Rules</a></li>
  </ul>

</body>
</html>
